{"version":3,"file":"index.modern.js","sources":["../src/components/MultiCrops/Crop/CropIcons.tsx","../src/components/MultiCrops/Crop/Crop.tsx","../src/components/MultiCrops/utils.ts","../src/components/MultiCrops/MultiCrops.tsx","../src/components/Canvas/Canvas.tsx","../src/components/Canvas/CanvasList.tsx","../src/hooks/useDidMountEffect.ts","../src/components/RegionSelector/RegionSelector.tsx"],"sourcesContent":["import React from 'react';\r\nimport styles from './Crop.module.scss';\r\n\r\nexport const CropDeleteIcon = (props) => (\r\n  <div className={styles.rmcIconContainer} {...props}>\r\n    <div className={styles.rmcRemove} />\r\n  </div>\r\n);\r\n\r\nexport const CropNumberIcon = ({\r\n  number = '',\r\n}: {\r\n  number: number | string;\r\n}) => <div className={styles.numberIcon}>{number}</div>;\r\n\r\nexport const CropContent = ({ content }) => (\r\n  <div className={styles.cropContent}>{content}</div>\r\n);\r\n","import React, {\r\n  Component,\r\n  CSSProperties,\r\n  memo,\r\n  RefObject,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from 'react';\r\nimport { equals, is, remove, update } from 'ramda';\r\nimport interact from 'interactjs';\r\nimport { CropContent, CropDeleteIcon, CropNumberIcon } from './CropIcons';\r\nimport styles from './Crop.module.scss';\r\nimport { ICropProps, TCoordinateType } from '../../../models';\r\n\r\nexport interface ICropState {\r\n  prevCoordinate: TCoordinateType;\r\n  prevCoordinates: TCoordinateType[];\r\n  isLeftBtnActive: boolean;\r\n  isRightBtnActive: boolean;\r\n  crop: HTMLDivElement | null;\r\n}\r\n\r\nclass Crop extends Component<ICropProps, ICropState> {\r\n  prevCoordinate: TCoordinateType = null!;\r\n\r\n  prevCoordinates: TCoordinateType[] = [];\r\n\r\n  isLeftBtnActive = false;\r\n\r\n  isRightBtnActive = false;\r\n\r\n  crop: HTMLDivElement | null = null!;\r\n\r\n  componentDidMount() {\r\n    const { parentImg } = this.props;\r\n    interact(this.crop!)\r\n      .draggable({\r\n        modifiers: [\r\n          interact.modifiers.restrictRect({\r\n            restriction: 'parent',\r\n          }),\r\n          interact.modifiers.restrictSize({\r\n            min: { width: 1, height: 1 },\r\n            max: { width: parentImg!.width, height: parentImg!.height },\r\n          }),\r\n        ],\r\n        inertia: true,\r\n      })\r\n      .resizable({\r\n        edges: {\r\n          left: true,\r\n          right: true,\r\n          bottom: true,\r\n          top: true,\r\n        },\r\n        modifiers: [\r\n          interact.modifiers.restrict({\r\n            restriction: 'parent',\r\n          }),\r\n          interact.modifiers.restrictSize({\r\n            min: { width: 1, height: 1 },\r\n            max: { width: parentImg!.width, height: parentImg!.height },\r\n          }),\r\n        ],\r\n        inertia: true,\r\n      })\r\n      .on(['dragstart', 'resizestart'], this.changeStartPosition)\r\n      .on(['dragmove', 'dragend', 'resizemove', 'resizeend'], this.handleChange)\r\n      .actionChecker(this.actionTrigger);\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps) {\r\n    const { coordinate, index } = this.props;\r\n    return (\r\n      !equals(nextProps.coordinate, coordinate) || nextProps.index !== index\r\n    );\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    interact(this.crop!).unset();\r\n  }\r\n\r\n  handleChange = (e) => {\r\n    const {\r\n      index,\r\n      coordinate,\r\n      coordinate: { x, y },\r\n      coordinates,\r\n      onResize,\r\n      onDrag,\r\n      onChange,\r\n      onComplete,\r\n      isChange,\r\n      parentImg,\r\n    } = this.props;\r\n\r\n    const { dx, dy } = e;\r\n\r\n    let nextCoordinate = {};\r\n\r\n    if (e.type === 'resizemove') {\r\n      const {\r\n        rect: { width, height },\r\n        deltaRect: { left, top, right, bottom },\r\n      } = e;\r\n      const resizeCoordinate = {\r\n        ...(((x + left >= 0 && x + left + width < parentImg!.width) ||\r\n          (x + left >= 0 && left < 0)) && { x: x + left }),\r\n        ...(((y + top >= 0 && y + top + height < parentImg!.height) ||\r\n          (y + top >= 0 && top < 0)) && { y: y + top }),\r\n        // x: ((x + left >= 0) && ((x + left + width) < parentImg.width) ) || ((x + left >= 0) && left < 0 ) ? x + left : x,\r\n        // y: ((y + top >= 0) && ((y + top + height) < parentImg.height) ) || ((y + top >= 0) && top < 0 ) ? y + top : x,\r\n      };\r\n      const resize = {\r\n        width:\r\n          resizeCoordinate.x + width <= parentImg!.width\r\n            ? x + left <= 0 && right === 0\r\n              ? coordinate.width\r\n              : width\r\n            : coordinate.width,\r\n        height:\r\n          resizeCoordinate.y + height <= parentImg!.height\r\n            ? y + top <= 0 && bottom === 0\r\n              ? coordinate.height\r\n              : height\r\n            : coordinate.height,\r\n      };\r\n      nextCoordinate = {\r\n        ...coordinate,\r\n        ...resizeCoordinate,\r\n        ...resize,\r\n      };\r\n    }\r\n    if (e.type === 'dragmove') {\r\n      nextCoordinate = { ...coordinate, x: x + dx, y: y + dy };\r\n    }\r\n    const nextCoordinates = update(index, nextCoordinate)(coordinates);\r\n\r\n    if (onResize && is(Function, onResize) && e.type === 'resizemove') {\r\n      onResize(nextCoordinate, index, nextCoordinates);\r\n    }\r\n    if (is(Function, onChange) && ['dragmove', 'resizemove'].includes(e.type)) {\r\n      onChange(nextCoordinate, index, nextCoordinates);\r\n    }\r\n    if (onDrag && is(Function, onDrag) && e.type === 'dragmove') {\r\n      onDrag(nextCoordinate, index, nextCoordinates);\r\n    }\r\n    if (['dragend', 'resizeend'].includes(e.type)) {\r\n      onComplete(coordinate, index, coordinates);\r\n      isChange(e);\r\n      document.removeEventListener('contextmenu', this.onContextMenu, false);\r\n    }\r\n  };\r\n\r\n  changeStartPosition = (e) => {\r\n    const { index, coordinate, coordinates, isChange } = this.props;\r\n\r\n    if (['dragstart', 'resizestart'].includes(e.type)) {\r\n      document.addEventListener('contextmenu', this.onContextMenu, false);\r\n      this.prevCoordinate = { ...coordinate };\r\n      this.prevCoordinates = [...coordinates];\r\n      this.prevCoordinates = update(index, this.prevCoordinate, coordinates);\r\n      isChange(e);\r\n    }\r\n  };\r\n\r\n  handleRestore = () => {\r\n    const { index, onRestore } = this.props;\r\n\r\n    if (is(Function, onRestore)) {\r\n      onRestore(this.prevCoordinate, index, this.prevCoordinates);\r\n    }\r\n  };\r\n\r\n  handleDelete = () => {\r\n    const { index, coordinate, onDelete, coordinates } = this.props;\r\n    const nextCoordinates = remove(index, 1)(coordinates);\r\n    if (is(Function, onDelete)) {\r\n      onDelete(coordinate, index, nextCoordinates);\r\n    }\r\n  };\r\n\r\n  onContextMenu = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (e.button === 2) {\r\n      if (this.isLeftBtnActive === false) {\r\n        this.handleDelete();\r\n      }\r\n      if (this.isLeftBtnActive === true) {\r\n        this.handleRestore();\r\n        this.isLeftBtnActive = false;\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  onMouseDown = (e) => {\r\n    const { outsideEvents } = this.props;\r\n    if (e.button === 0) {\r\n      document.addEventListener('mouseup', outsideEvents, false);\r\n      document.addEventListener('keydown', outsideEvents, false);\r\n      this.isLeftBtnActive = true;\r\n    }\r\n    if (e.button === 2) {\r\n      this.isRightBtnActive = true;\r\n    }\r\n  };\r\n\r\n  onMouseUp = (e) => {\r\n    const { outsideEvents } = this.props;\r\n    if (e.button === 0) {\r\n      document.removeEventListener('mouseup', outsideEvents, false);\r\n      document.removeEventListener('keydown', outsideEvents, false);\r\n      document.removeEventListener('contextmenu', this.onContextMenu, false);\r\n      this.isLeftBtnActive = false;\r\n    }\r\n    if (e.button === 2) {\r\n      this.isRightBtnActive = false;\r\n    }\r\n  };\r\n\r\n  onKeyDown = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (e.code === 'Escape') {\r\n      this.handleRestore();\r\n      this.isLeftBtnActive = false;\r\n    }\r\n  };\r\n\r\n  onKeyUp = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  };\r\n\r\n  cropStyle = (coordinate): CSSProperties => {\r\n    const { x, y, width, height } = coordinate;\r\n\r\n    return {\r\n      display: 'inline-block',\r\n      position: 'absolute',\r\n      transform: 'translate3d(0, 0, 0)',\r\n      boxSizing: 'border-box',\r\n      cursor: 'move',\r\n      width,\r\n      height,\r\n      top: y,\r\n      left: x,\r\n      border: '1px solid',\r\n      borderImageSource:\r\n        'url(\"data:image/gif;base64,R0lGODlhCgAKAJECAAAAAP///////wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OEI5RDc5MTFDNkE2MTFFM0JCMDZEODI2QTI4MzJBOTIiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OEI5RDc5MTBDNkE2MTFFM0JCMDZEODI2QTI4MzJBOTIiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuZGlkOjAyODAxMTc0MDcyMDY4MTE4MDgzQzNDMjA5MzREQ0ZDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAyODAxMTc0MDcyMDY4MTE4MDgzQzNDMjA5MzREQ0ZDIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEBQoAAgAsAAAAAAoACgAAAhWEERkn7W3ei7KlagMWF/dKgYeyGAUAIfkEBQoAAgAsAAAAAAoACgAAAg+UYwLJ7RnQm7QmsCyVKhUAIfkEBQoAAgAsAAAAAAoACgAAAhCUYgLJHdiinNSAVfOEKoUCACH5BAUKAAIALAAAAAAKAAoAAAIRVISAdusPo3RAzYtjaMIaUQAAIfkEBQoAAgAsAAAAAAoACgAAAg+MDiem7Q8bSLFaG5il6xQAIfkEBQoAAgAsAAAAAAoACgAAAg+UYRLJ7QnQm7SmsCyVKhUAIfkEBQoAAgAsAAAAAAoACgAAAhCUYBLJDdiinNSEVfOEKoECACH5BAUKAAIALAAAAAAKAAoAAAIRFISBdusPo3RBzYsjaMIaUQAAOw==\")',\r\n      borderImageSlice: '1',\r\n      borderImageRepeat: 'repeat',\r\n      msTouchAction: 'none',\r\n      touchAction: 'none',\r\n      userSelect: 'none',\r\n      background: '#262626',\r\n      opacity: 0.5,\r\n    };\r\n  };\r\n\r\n  actionTrigger = (\r\n    pointer,\r\n    event,\r\n    action,\r\n    interactable,\r\n    element,\r\n    interaction,\r\n  ) => {\r\n    if (event.type === 'pointermove') {\r\n      //\r\n    }\r\n\r\n    if (event.type === 'pointerdown') {\r\n      //\r\n    }\r\n\r\n    return action;\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      coordinate,\r\n      index,\r\n      cropConfig: {\r\n        hasNumberIcon = true,\r\n        hasContent = false,\r\n        hasDeleteButton = true,\r\n      },\r\n    } = this.props;\r\n\r\n    return (\r\n      <div\r\n        onMouseDown={this.onMouseDown}\r\n        onMouseUp={this.onMouseUp}\r\n        onContextMenu={this.onContextMenu}\r\n        style={this.cropStyle(coordinate)}\r\n        ref={(crop) => {\r\n          this.crop = crop;\r\n        }}\r\n        onKeyDown={this.onKeyDown}\r\n        onKeyUp={this.onKeyUp}\r\n        tabIndex={0}\r\n      >\r\n        {/* <div> */}\r\n        {hasNumberIcon && <CropNumberIcon number={index + 1} />}\r\n        {hasDeleteButton && <CropDeleteIcon onClick={this.handleDelete} />}\r\n        {hasContent && <CropContent content={coordinate?.content} />}\r\n        {/* </div> */}\r\n        {[\r\n          styles.ordN,\r\n          styles.ordNe,\r\n          styles.ordNw,\r\n          styles.ordS,\r\n          styles.ordSe,\r\n          styles.ordSw,\r\n          styles.ordE,\r\n          styles.ordW,\r\n        ].map((style, id) => (\r\n          <div className={style} key={id} />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Crop;\r\n","import { v4 as uuidv4 } from 'uuid';\r\nimport { assoc, map, omit } from 'ramda';\r\n\r\nexport const addId = map(assoc('id', uuidv4()));\r\n\r\nexport const removeId = map(omit(['id']));\r\n","import React, { useRef, useState } from 'react';\r\nimport { addIndex, both, clone, complement, equals, is, map } from 'ramda';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport Crop from './Crop/Crop';\r\nimport styles from './MultiCrops.module.scss';\r\nimport { IMultiCropsProps } from '../../models';\r\n\r\nconst isValidPoint = (point: { x?: number; y?: number } = {}): boolean => {\r\n  const strictNumber = (number) =>\r\n    both(is(Number), complement(equals(NaN)))(number);\r\n  if (point?.x && point?.y) {\r\n    return strictNumber(point.x) && strictNumber(point.y);\r\n  }\r\n  return false;\r\n};\r\n\r\n// export interface IMultiCropsProps {\r\n//   coordinate?: TCoordinateType;\r\n//   coordinates?: TCoordinateType[];\r\n//   src?: string;\r\n//   cropContent?: boolean;\r\n//   hasDeleteButton?: boolean;\r\n//   hasNumberIcon?: boolean;\r\n//   height?: number;\r\n//   onDraw?: (...rest) => any | void;\r\n//   onChange: (...rest) => any | void;\r\n//   onComplete: (...rest) => any | void;\r\n//   onRestore: (...rest) => any | void;\r\n//   onDelete: (...rest) => any | void;\r\n//   onLoad: (...rest) => any | void;\r\n//   inProportions?: boolean;\r\n//   maxCrops?: number;\r\n//   aspectRatio?: number;\r\n// }\r\n\r\nconst MultiCrops = (props: IMultiCropsProps): React.ReactElement => {\r\n  const {\r\n    coordinate,\r\n    coordinates = [],\r\n    src = '',\r\n    maxCrops = 5,\r\n    onDraw,\r\n    onChange,\r\n    onComplete,\r\n    onRestore,\r\n    onLoad,\r\n  } = props;\r\n\r\n  const imgRef = useRef<HTMLImageElement | null>(null);\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  const [drawingIndex, setDrawingIndex] = useState(-1);\r\n  const [pointA, setPointA] = useState<{ x?: number; y?: number }>({});\r\n\r\n  const [id, setId] = useState(uuidv4());\r\n\r\n  const [prevCoordinate, setPrevCoordinate] = useState({});\r\n  const [prevCoordinates, setPrevCoordinates] = useState([]);\r\n\r\n  const [isEscBtnTarget, setIsEscBtnTarget] = useState(false);\r\n  const [isDragResize, setIsDragResize] = useState(false);\r\n  const [isLeftBtnTarget, setIsLeftBtnTarget] = useState(false);\r\n  const [mouseLeave, setMouseLeave] = useState(false);\r\n\r\n  const isChange = (e) => {\r\n    if (['dragstart', 'resizestart'].includes(e.type)) {\r\n      setIsDragResize(true);\r\n    }\r\n    if (['dragend', 'resizeend'].includes(e.type)) {\r\n      setIsDragResize(false);\r\n    }\r\n  };\r\n\r\n  const renderCrops = (props) => {\r\n    const { coordinates } = props;\r\n    const indexedMap = addIndex(map);\r\n    return indexedMap((coor, index) => {\r\n      return (\r\n        <Crop\r\n          // improve performance when delete crop in middle array\r\n          key={coor.id || index}\r\n          index={index}\r\n          coordinate={coor}\r\n          isChange={(e) => {\r\n            isChange(e);\r\n          }}\r\n          parentImg={imgRef.current}\r\n          {...props}\r\n        />\r\n      );\r\n    })(coordinates);\r\n  };\r\n\r\n  const getCursorPosition = (e) => {\r\n    const { left, top } = containerRef.current!.getBoundingClientRect();\r\n    if (e.type === 'touchstart' || e.type === 'touchmove') {\r\n      return {\r\n        x: e.touches[0].pageX - left,\r\n        y: e.touches[0].pageY - top,\r\n      };\r\n    }\r\n    if (e.type === 'mousedown' || e.type === 'mousemove') {\r\n      return {\r\n        x: e.clientX - left,\r\n        y: e.clientY - top,\r\n      };\r\n    }\r\n    return { x: 0, y: 0 };\r\n  };\r\n\r\n  const handleMouseDown = (e) => {\r\n    document.removeEventListener('mouseup', outsideEvents, false);\r\n    document.removeEventListener('keydown', outsideEvents, false);\r\n    document.removeEventListener('contextmenu', onContextMenu, false);\r\n    setIsDragResize(false);\r\n    if (\r\n      coordinates.length <= maxCrops &&\r\n      (e.button === 0 || e.type === 'touchstart')\r\n    ) {\r\n      setIsLeftBtnTarget(true);\r\n      if (e.target === imgRef.current || e.target === containerRef.current) {\r\n        const { x, y } = getCursorPosition(e);\r\n        setDrawingIndex(coordinates.length);\r\n        setPointA({ x, y });\r\n        setId(uuidv4());\r\n        setIsLeftBtnTarget(true);\r\n        setPrevCoordinate({});\r\n        setPrevCoordinates(clone(coordinates));\r\n        setIsEscBtnTarget(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const outsideEvents = (e): void | boolean => {\r\n    if (e.button === 0) {\r\n      if (isEscBtnTarget === false) {\r\n        if (is(Function, onRestore)) {\r\n          onRestore(coordinate, drawingIndex, coordinates);\r\n        }\r\n        handleMouseUp();\r\n      }\r\n      if (isEscBtnTarget === true && e.target !== imgRef.current) {\r\n        restoreCrops();\r\n        setIsEscBtnTarget(false);\r\n      }\r\n      document.removeEventListener('mouseup', outsideEvents, false);\r\n      document.removeEventListener('keydown', outsideEvents, false);\r\n      document.removeEventListener('contextmenu', onContextMenu, false);\r\n    }\r\n\r\n    if (e.code === 'Escape') {\r\n      setIsEscBtnTarget(true);\r\n    }\r\n\r\n    if (e.button === 2) {\r\n      if (e.target !== imgRef.current) {\r\n        restoreCrops();\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  const handleMouseMove = (e) => {\r\n    if (\r\n      coordinates.length <= maxCrops &&\r\n      (e.button === 0 || e.type === 'touchmove')\r\n    ) {\r\n      if (\r\n        isValidPoint(pointA) &&\r\n        e.target.offsetParent === imgRef?.current?.offsetParent\r\n      ) {\r\n        const pointB = getCursorPosition(e);\r\n        // get the drawing coordinate\r\n        if (pointA.x && pointA.y) {\r\n          const coordinate = {\r\n            x: Math.min(pointA.x, pointB.x),\r\n            y: Math.min(pointA.y, pointB.y),\r\n            width: Math.abs(pointA.x - pointB.x),\r\n            height: Math.abs(pointA.y - pointB.y),\r\n            id,\r\n          };\r\n\r\n          const nextCoordinates = clone(coordinates);\r\n          nextCoordinates[drawingIndex] = coordinate;\r\n          if (onDraw && is(Function, onDraw)) {\r\n            onDraw(coordinate, drawingIndex, nextCoordinates);\r\n          }\r\n          if (is(Function, onChange)) {\r\n            onChange(coordinate, drawingIndex, nextCoordinates);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const restoreCrops = () => {\r\n    if (is(Function, onRestore)) {\r\n      onRestore(prevCoordinate, drawingIndex - 1, prevCoordinates);\r\n    }\r\n\r\n    setPointA({ x: 0, y: 0 });\r\n    setIsLeftBtnTarget(false);\r\n    setIsEscBtnTarget(false);\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    setPointA({ x: 0, y: 0 });\r\n    setIsLeftBtnTarget(false);\r\n    setMouseLeave(false);\r\n    setIsEscBtnTarget(false);\r\n  };\r\n\r\n  const handleMouseLeave = () => {\r\n    if (isDragResize === false && isLeftBtnTarget === true) {\r\n      document.addEventListener('contextmenu', onContextMenu, false);\r\n      document.addEventListener('mouseup', outsideEvents, false);\r\n      document.addEventListener('keydown', outsideEvents, false);\r\n    }\r\n    setMouseLeave(true);\r\n  };\r\n\r\n  const handleMouseEnter = () => {\r\n    document.removeEventListener('mouseup', outsideEvents, false);\r\n    document.removeEventListener('keydown', outsideEvents, false);\r\n    document.removeEventListener('contextmenu', onContextMenu, false);\r\n    setMouseLeave(false);\r\n  };\r\n\r\n  const onKeyDown = (e) => {\r\n    if (e.code === 'Escape') {\r\n      setIsEscBtnTarget(true);\r\n    }\r\n  };\r\n\r\n  const onContextMenu = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    return false;\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={styles.multiCrops}\r\n      onTouchStart={handleMouseDown}\r\n      onTouchMove={handleMouseMove}\r\n      onTouchEnd={() => {\r\n        if (!isEscBtnTarget) {\r\n          handleMouseUp();\r\n          return;\r\n        }\r\n        restoreCrops();\r\n      }}\r\n      onMouseDown={handleMouseDown}\r\n      onMouseMove={handleMouseMove}\r\n      onMouseLeave={handleMouseLeave}\r\n      onMouseEnter={handleMouseEnter}\r\n      onKeyDown={onKeyDown}\r\n      onMouseUp={() => {\r\n        if (!isEscBtnTarget) {\r\n          handleMouseUp();\r\n          return;\r\n        }\r\n        restoreCrops();\r\n      }}\r\n      ref={(container) => {\r\n        containerRef.current = container;\r\n      }}\r\n      tabIndex={0}\r\n    >\r\n      {src && (\r\n        <img\r\n          ref={(img) => {\r\n            imgRef.current = img;\r\n          }}\r\n          width=\"100%\"\r\n          src={src}\r\n          onLoad={onLoad}\r\n          alt=\"\"\r\n          draggable={false}\r\n          onDragStart={(e) => {\r\n            e.preventDefault();\r\n          }}\r\n        />\r\n      )}\r\n      {renderCrops(props)}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport { removeId, addId } from './utils';\r\nexport default MultiCrops;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { TCoordinateType } from '../MultiCrops/Crop/CropFC';\r\nimport styles from './Canvas.module.scss';\r\n\r\nfunction generateDownload(canvas, crop) {\r\n  if (!crop || !canvas) {\r\n    return;\r\n  }\r\n\r\n  canvas.toBlob(\r\n    (blob) => {\r\n      const previewUrl = window.URL.createObjectURL(blob);\r\n\r\n      const anchor = document.createElement('a');\r\n      anchor.download = `canvas_${crop.id}.png`;\r\n      anchor.href = URL.createObjectURL(blob);\r\n      anchor.click();\r\n\r\n      window.URL.revokeObjectURL(previewUrl);\r\n    },\r\n    'image/png',\r\n    1,\r\n  );\r\n}\r\n\r\nconst useCanvas = (\r\n  props: { crop: TCoordinateType; img: HTMLImageElement },\r\n  callback,\r\n) => {\r\n  const { crop = null, img = null } = props;\r\n\r\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\r\n  const imgRef = useRef<HTMLImageElement | null>(null);\r\n  imgRef.current = img;\r\n\r\n  useEffect(() => {\r\n    const image = imgRef.current;\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas?.getContext('2d');\r\n    callback([canvas, ctx, image]);\r\n  }, [crop]);\r\n\r\n  return canvasRef;\r\n};\r\n\r\nconst Canvas = (props) => {\r\n  const { crop } = props;\r\n\r\n  const [isHover, setIsHover] = useState(false);\r\n\r\n  const canvasRef = useCanvas(props, ([canvas, ctx, image]) => {\r\n    const scaleX = image.naturalWidth / image.width;\r\n    const scaleY = image.naturalHeight / image.height;\r\n    const pixelRatio = window.devicePixelRatio;\r\n\r\n    canvas.width = crop.width * pixelRatio;\r\n    canvas.height = crop.height * pixelRatio;\r\n\r\n    ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\r\n    ctx.imageSmoothingQuality = 'high';\r\n\r\n    ctx.drawImage(\r\n      image,\r\n      crop.x * scaleX,\r\n      crop.y * scaleY,\r\n      crop.width * scaleX,\r\n      crop.height * scaleY,\r\n      0,\r\n      0,\r\n      crop.width,\r\n      crop.height,\r\n    );\r\n  });\r\n\r\n  return (\r\n    <div\r\n      className={styles.canvasItem}\r\n      onMouseEnter={() => {\r\n        setIsHover(true);\r\n      }}\r\n      onMouseLeave={() => {\r\n        setIsHover(false);\r\n      }}\r\n    >\r\n      {isHover && <div className={styles.canvasContent}>{crop.content}</div>}\r\n      <canvas ref={canvasRef} className={styles.canvasImg} />\r\n      {isHover && (\r\n        <div\r\n          className={styles.canvasDownloadButton}\r\n          onClick={() => generateDownload(canvasRef.current, crop)}\r\n        >\r\n          Download\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Canvas;\r\n","import React from 'react';\r\nimport Canvas from './Canvas';\r\nimport styles from './CanvasList.module.scss';\r\n\r\nconst CanvasList = (props) => {\r\n  const { canvas, img, style } = props;\r\n  return (\r\n    <div className={styles.canvasList} style={style}>\r\n      {canvas.map((crop, i) => (\r\n        <Canvas key={crop.id || i} crop={crop} img={img} />\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CanvasList;\r\n","import { useEffect, useRef } from 'react';\r\n\r\nconst useDidMountEffect = (func, deps) => {\r\n  const didMount = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (didMount.current) {\r\n      func();\r\n    } else {\r\n      didMount.current = true;\r\n    }\r\n  }, deps);\r\n};\r\n\r\nexport default useDidMountEffect;\r\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { is } from 'ramda';\r\nimport MultiCrops from '../MultiCrops/MultiCrops';\r\nimport CanvasList from '../Canvas/CanvasList';\r\nimport { useDidMountEffect } from '../../hooks';\r\nimport styles from './RegionSelector.module.scss';\r\nimport { IRegionSelectorProps } from '../../models';\r\n\r\nconst RegionSelector = (props: IRegionSelectorProps): React.ReactElement => {\r\n  const {\r\n    src,\r\n    giveCompletedCrops = null,\r\n    completedCrops = [],\r\n    inProportions = false,\r\n    showCanvas = true,\r\n    giveCanvas,\r\n    width = 460,\r\n  } = props;\r\n\r\n  const imgRef = useRef<HTMLImageElement | null>(null);\r\n  const [crops, setCrops] = useState<any[]>([]);\r\n  const [canvas, setCanvas] = useState<any[]>([]);\r\n  const [didMount, setDidMount] = useState<boolean>(false);\r\n\r\n  const completed = (crops) => {\r\n    setCanvas(crops);\r\n    if (giveCompletedCrops && is(Function, giveCompletedCrops)) {\r\n      if (inProportions) {\r\n        giveCompletedCrops &&\r\n          giveCompletedCrops(crops.map((crop) => calcProportions(crop)));\r\n      }\r\n      if (!inProportions) {\r\n        giveCompletedCrops && giveCompletedCrops(crops);\r\n      }\r\n    }\r\n  };\r\n\r\n  const calcPosition = (crop) => {\r\n    const { width, height } = (typeof imgRef?.current !== 'undefined' &&\r\n      imgRef?.current) || { width: 0, height: 0 };\r\n\r\n    return {\r\n      ...crop,\r\n      x: parseInt((width * crop.x).toFixed(0), 10),\r\n      y: parseInt((height * crop.y).toFixed(0), 10),\r\n      height: parseInt((height * crop.height).toFixed(0), 10),\r\n      width: parseInt((width * crop.width).toFixed(0), 10),\r\n    };\r\n  };\r\n\r\n  const calcProportions = (crop) => {\r\n    const { width, height } = (typeof imgRef?.current !== 'undefined' &&\r\n      imgRef?.current) || { width: 0, height: 0 };\r\n    const proportions = {\r\n      ...crop,\r\n      x: (crop.x / width).toFixed(2),\r\n      y: (crop.y / height).toFixed(2),\r\n      height: (crop.height / height).toFixed(2),\r\n      width: (crop.width / width).toFixed(2),\r\n    };\r\n    return proportions;\r\n  };\r\n\r\n  useDidMountEffect(() => {\r\n    if (didMount && completedCrops) {\r\n      if (inProportions) {\r\n        setCrops(() => completedCrops.map((crop) => calcPosition(crop)));\r\n      }\r\n      if (!inProportions) {\r\n        setCrops(completedCrops);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const onLoad = useCallback(\r\n    (img) => {\r\n      imgRef.current = img.target;\r\n      setDidMount(true);\r\n      if (inProportions) {\r\n        setCrops(() => completedCrops.map((crop) => calcPosition(crop)));\r\n        setCanvas(() => completedCrops.map((crop) => calcPosition(crop)));\r\n      }\r\n      if (!inProportions) {\r\n        setCrops(completedCrops);\r\n        setCanvas(completedCrops);\r\n      }\r\n    },\r\n    [completedCrops, inProportions],\r\n  );\r\n\r\n  const onChange = useCallback((crop, index, crops) => {\r\n    setCrops(crops);\r\n    // completed(crops);\r\n  }, []);\r\n\r\n  const onDelete = useCallback((crop, index, crops) => {\r\n    setCrops(crops);\r\n    completed(crops);\r\n  }, []);\r\n\r\n  const onRestore = useCallback((crop, index, crops) => {\r\n    setCrops(crops);\r\n    completed(crops);\r\n  }, []);\r\n\r\n  const onComplete = useCallback((crop, index, crops) => {\r\n    setCrops(crops);\r\n    completed(crops);\r\n  }, []);\r\n\r\n  return (\r\n    <div className={styles.regionSelector}>\r\n      <div\r\n        style={{ width }}\r\n        className={styles.multiCrops}\r\n        onTouchEnd={() => {\r\n          completed(crops);\r\n        }}\r\n        onMouseUp={(e) => {\r\n          if (e.button === 0) {\r\n            completed(crops);\r\n          }\r\n        }}\r\n      >\r\n        <MultiCrops\r\n          src={src}\r\n          coordinates={crops}\r\n          onChange={onChange}\r\n          onDelete={onDelete}\r\n          onRestore={onRestore}\r\n          onComplete={onComplete}\r\n          onLoad={onLoad}\r\n          width={imgRef.current?.width || width}\r\n          {...props}\r\n        />\r\n      </div>\r\n      {showCanvas && (\r\n        <CanvasList\r\n          canvas={canvas}\r\n          img={imgRef.current}\r\n          style={{\r\n            width,\r\n            height: imgRef.current?.height ? imgRef.current.height + 10 : 0,\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RegionSelector;\r\n"],"names":["CropDeleteIcon","props","styles","rmcIconContainer","rmcRemove","CropNumberIcon","number","numberIcon","CropContent","content","cropContent","Crop","Component","constructor","e","index","coordinate","x","y","coordinates","onResize","onDrag","onChange","onComplete","isChange","parentImg","dx","dy","nextCoordinate","type","rect","width","height","deltaRect","left","top","right","bottom","resizeCoordinate","resize","nextCoordinates","update","is","Function","includes","document","removeEventListener","onContextMenu","addEventListener","prevCoordinate","prevCoordinates","onRestore","onDelete","remove","preventDefault","stopPropagation","button","isLeftBtnActive","handleDelete","handleRestore","outsideEvents","isRightBtnActive","code","display","position","transform","boxSizing","cursor","border","borderImageSource","borderImageSlice","borderImageRepeat","msTouchAction","touchAction","userSelect","background","opacity","pointer","event","action","interactable","element","interaction","componentDidMount","interact","crop","draggable","modifiers","restrictRect","restriction","restrictSize","min","max","inertia","resizable","edges","restrict","on","changeStartPosition","handleChange","actionChecker","actionTrigger","shouldComponentUpdate","nextProps","equals","componentWillUnmount","unset","render","cropConfig","hasNumberIcon","hasContent","hasDeleteButton","onMouseDown","onMouseUp","cropStyle","onKeyDown","onKeyUp","ordN","ordNe","ordNw","ordS","ordSe","ordSw","ordE","ordW","map","style","id","addId","assoc","uuidv4","removeId","omit","isValidPoint","point","strictNumber","both","Number","complement","NaN","MultiCrops","src","maxCrops","onDraw","onLoad","imgRef","useRef","containerRef","drawingIndex","setDrawingIndex","useState","pointA","setPointA","setId","setPrevCoordinate","setPrevCoordinates","isEscBtnTarget","setIsEscBtnTarget","isDragResize","setIsDragResize","isLeftBtnTarget","setIsLeftBtnTarget","mouseLeave","setMouseLeave","renderCrops","indexedMap","addIndex","coor","current","getCursorPosition","getBoundingClientRect","touches","pageX","pageY","clientX","clientY","handleMouseDown","length","target","clone","handleMouseUp","restoreCrops","handleMouseMove","offsetParent","pointB","Math","abs","handleMouseLeave","handleMouseEnter","multiCrops","container","img","generateDownload","canvas","toBlob","blob","previewUrl","window","URL","createObjectURL","anchor","createElement","download","href","click","revokeObjectURL","useCanvas","callback","canvasRef","useEffect","image","ctx","getContext","Canvas","isHover","setIsHover","scaleX","naturalWidth","scaleY","naturalHeight","pixelRatio","devicePixelRatio","setTransform","imageSmoothingQuality","drawImage","canvasItem","canvasContent","canvasImg","canvasDownloadButton","CanvasList","canvasList","i","useDidMountEffect","func","deps","didMount","RegionSelector","giveCompletedCrops","completedCrops","inProportions","showCanvas","giveCanvas","crops","setCrops","setCanvas","setDidMount","completed","calcProportions","calcPosition","parseInt","toFixed","proportions","useCallback","regionSelector"],"mappings":"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"}