{"version":3,"file":"index.js","sources":["../src/hooks/useCanvas.tsx","../src/hooks/useDidMountEffect.ts","../src/components/Canvas/Canvas.tsx","../src/components/MultiCrops/Crop/CropIcons.tsx","../src/components/MultiCrops/Crop/Crop.tsx","../src/components/MultiCrops/utils.ts","../src/components/MultiCrops/MultiCrops.tsx","../src/RegionSelector.tsx"],"sourcesContent":["import { MutableRefObject, useEffect, useRef, useState } from 'react';\r\n\r\nconst useCanvas = (props, callback): MutableRefObject<HTMLCanvasElement | null> => {\r\n  const { crop, img } = props;\r\n\r\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\r\n  const imgRef = useRef<HTMLImageElement | null>(null);\r\n  imgRef.current = img;\r\n\r\n  useEffect(() => {\r\n    const image = imgRef.current;\r\n    const canvas = canvasRef.current;\r\n    if (canvas) {\r\n      const canvasContext = canvas.getContext('2d');\r\n      if (canvasContext) {\r\n        callback([canvas, canvasContext, image]);\r\n      }\r\n    }\r\n  }, [crop]);\r\n\r\n  return canvasRef;\r\n};\r\n\r\nexport default useCanvas;\r\n","import { useEffect, useRef } from 'react';\r\n\r\nconst useDidMountEffect = (func, deps) => {\r\n  const didMount = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (didMount.current) {\r\n      func();\r\n    } else {\r\n      didMount.current = true;\r\n    }\r\n  }, deps);\r\n};\r\n\r\nexport default useDidMountEffect;\r\n","import React, { useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useCanvas } from '../../hooks';\r\n\r\nfunction generateDownload(canvas, crop) {\r\n  if (!crop || !canvas) {\r\n    return;\r\n  }\r\n  canvas.toBlob(\r\n    (blob) => {\r\n      const previewUrl = window.URL.createObjectURL(blob);\r\n\r\n      const anchor = document.createElement('a');\r\n      anchor.download = `crop_${crop.id}.png`;\r\n      anchor.href = URL.createObjectURL(blob);\r\n      anchor.click();\r\n\r\n      window.URL.revokeObjectURL(previewUrl);\r\n    },\r\n    'image/png',\r\n    1,\r\n  );\r\n}\r\n\r\nexport interface ICanvasProps {\r\n  crop: any;\r\n  img: any;\r\n}\r\n\r\nconst Canvas = (props) => {\r\n  const { crop = null, img = null } = props;\r\n\r\n  const [isHover, setIsHover] = useState<boolean>(false);\r\n\r\n  const canvasRef = useCanvas(props, ([canvas, canvasContext, image]) => {\r\n    const scaleX = image.naturalWidth / image.width;\r\n    const scaleY = image.naturalHeight / image.height;\r\n    const pixelRatio = window.devicePixelRatio;\r\n\r\n    canvas.width = crop.width * pixelRatio;\r\n    canvas.height = crop.height * pixelRatio;\r\n\r\n    canvasContext.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\r\n    canvasContext.imageSmoothingQuality = 'high';\r\n\r\n    canvasContext.drawImage(\r\n      image,\r\n      crop.x * scaleX,\r\n      crop.y * scaleY,\r\n      crop.width * scaleX,\r\n      crop.height * scaleY,\r\n      0,\r\n      0,\r\n      crop.width,\r\n      crop.height,\r\n    );\r\n  });\r\n\r\n  return (\r\n    <div\r\n      style={{ position: 'relative' }}\r\n      onMouseEnter={() => {\r\n        setIsHover(true);\r\n      }}\r\n      onMouseLeave={() => {\r\n        setIsHover(false);\r\n      }}\r\n    >\r\n      <canvas ref={canvasRef} />\r\n      {isHover && (\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            top: 5,\r\n            right: 5,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n            borderRadius: 2,\r\n            padding: '0 4px',\r\n            background: '#262626',\r\n            opacity: 0.5,\r\n            cursor: 'pointer',\r\n          }}\r\n          onClick={() => generateDownload(canvasRef.current, crop)}\r\n        >\r\n          Download\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Canvas;\r\n","import React from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport styles from './Crop.module.scss'\r\n\r\nexport const DeleteIcon = (props) => (\r\n    <div\r\n        className={styles.rmcIconContainer}\r\n        {...props}\r\n    >\r\n        <div className={styles.rmcRemove}/>\r\n    </div>\r\n\r\n)\r\n\r\nexport const NumberIcon = ({number}) => (\r\n    <div className={styles.numberIcon}>\r\n        {number}\r\n    </div>\r\n)\r\n\r\nexport const CropContent = ({content}) => (\r\n    <div className={styles.cropContent}>\r\n        {content}\r\n    </div>\r\n)\r\n\r\nconst {number, string} = PropTypes\r\n\r\nNumberIcon.propTypes = {\r\n    number: PropTypes.oneOfType([number, string]),\r\n}\r\n\r\nNumberIcon.defaultProps = {\r\n    number: '',\r\n}\r\n\r\n","import React, { Component, CSSProperties, RefObject, useEffect, useRef, useState } from 'react';\r\nimport { equals, is, remove, update } from 'ramda';\r\nimport interact from 'interactjs';\r\nimport { CropContent, DeleteIcon, NumberIcon } from './CropIcons';\r\nimport styles from './Crop.module.scss';\r\n\r\nexport type TCoordinateType = {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  content: any;\r\n};\r\n\r\nexport interface ICropProps {\r\n  coordinate: TCoordinateType;\r\n  coordinates: TCoordinateType[];\r\n  cropContent?: boolean;\r\n  hasDeleteButton?: boolean;\r\n  hasNumberIcon?: boolean;\r\n  index: number;\r\n  onResize: (...rest) => any | void;\r\n  onDrag: (...rest) => any | void;\r\n  onDelete: (...rest) => any | void;\r\n  onChange: (...rest) => any | void;\r\n  onComplete: (...rest) => any | void;\r\n  onRestore: (...rest) => any | void;\r\n  isChange: (...rest) => any | void;\r\n  parentImg: HTMLImageElement | null;\r\n}\r\n\r\nexport interface ICropState {\r\n  prevCoordinate: TCoordinateType;\r\n  prevCoordinates: TCoordinateType[];\r\n  isLeftBtnActive: boolean;\r\n  isRightBtnActive: boolean;\r\n  crop: HTMLDivElement;\r\n  outsideEvents: any;\r\n}\r\n\r\nconst Crop = (props: ICropProps): React.ReactElement => {\r\n  const {\r\n    coordinate,\r\n    coordinates,\r\n    cropContent = false,\r\n    hasDeleteButton = true,\r\n    hasNumberIcon = true,\r\n    index,\r\n    onResize,\r\n    onDrag,\r\n    onDelete,\r\n    onChange,\r\n    onComplete,\r\n    onRestore,\r\n    isChange,\r\n    parentImg,\r\n  } = props;\r\n\r\n  const [prevCoordinate, setPrevCoordinate] = useState<TCoordinateType>();\r\n  const [prevCoordinates, setPrevCoordinates] = useState<TCoordinateType[]>([]);\r\n  const [isLeftBtnActive, setIsLeftBtnActive] = useState<boolean>(false);\r\n  const [isRightBtnActive, setIsRightBtnActive] = useState<boolean>(false);\r\n\r\n  const cropRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    interact(cropRef.current!)\r\n      .draggable({\r\n        modifiers: [\r\n          interact.modifiers.restrictRect({\r\n            restriction: 'parent',\r\n          }),\r\n          interact.modifiers.restrictSize({\r\n            min: { width: 1, height: 1 },\r\n            max: { width: parentImg!.width, height: parentImg!.height },\r\n          }),\r\n        ],\r\n        inertia: true,\r\n      })\r\n      .resizable({\r\n        edges: {\r\n          left: true,\r\n          right: true,\r\n          bottom: true,\r\n          top: true,\r\n        },\r\n        modifiers: [\r\n          interact.modifiers.restrict({\r\n            restriction: 'parent',\r\n          }),\r\n          interact.modifiers.restrictSize({\r\n            min: { width: 1, height: 1 },\r\n            max: { width: parentImg!.width, height: parentImg!.height },\r\n          }),\r\n        ],\r\n        inertia: true,\r\n      })\r\n      .on(['dragstart', 'resizestart'], changeStartPosition)\r\n      .on(['dragmove', 'dragend', 'resizemove', 'resizeend'], handleChange)\r\n      .actionChecker(actionTrigger);\r\n\r\n    return () => {\r\n      interact(cropRef.current!).unset();\r\n    };\r\n  }, []);\r\n\r\n  const handleChange = (e) => {\r\n    const { x, y } = coordinate;\r\n\r\n    const { dx, dy } = e;\r\n\r\n    let nextCoordinate = {};\r\n\r\n    if (e.type === 'resizemove') {\r\n      const {\r\n        rect: { width, height },\r\n        deltaRect: { left, top, right, bottom },\r\n      } = e;\r\n      const resizeCoordinate = {\r\n        ...(((x + left >= 0 && x + left + width < parentImg!.width) || (x + left >= 0 && left < 0)) && {\r\n          x: x + left,\r\n        }),\r\n        ...(((y + top >= 0 && y + top + height < parentImg!.height) || (y + top >= 0 && top < 0)) && { y: y + top }),\r\n        // x: ((x + left >= 0) && ((x + left + width) < parentImg.width) ) || ((x + left >= 0) && left < 0 ) ? x + left : x,\r\n        // y: ((y + top >= 0) && ((y + top + height) < parentImg.height) ) || ((y + top >= 0) && top < 0 ) ? y + top : x,\r\n      };\r\n      const resize = {\r\n        width:\r\n          resizeCoordinate.x + width <= parentImg!.width\r\n            ? x + left <= 0 && right === 0\r\n              ? coordinate.width\r\n              : width\r\n            : coordinate.width,\r\n        height:\r\n          resizeCoordinate.y + height <= parentImg!.height\r\n            ? y + top <= 0 && bottom === 0\r\n              ? coordinate.height\r\n              : height\r\n            : coordinate.height,\r\n      };\r\n      nextCoordinate = {\r\n        ...coordinate,\r\n        ...resizeCoordinate,\r\n        ...resize,\r\n      };\r\n    }\r\n    if (e.type === 'dragmove') {\r\n      nextCoordinate = { ...coordinate, x: x + dx, y: y + dy };\r\n    }\r\n    const nextCoordinates = update(index, nextCoordinate)(coordinates);\r\n\r\n    if (is(Function, onResize) && e.type === 'resizemove') {\r\n      onResize(nextCoordinate, index, nextCoordinates);\r\n    }\r\n    if (is(Function, onChange) && ['dragmove', 'resizemove'].includes(e.type)) {\r\n      onChange(nextCoordinate, index, nextCoordinates);\r\n    }\r\n    if (is(Function, onDrag) && e.type === 'dragmove') {\r\n      onDrag(nextCoordinate, index, nextCoordinates);\r\n    }\r\n    if (['dragend', 'resizeend'].includes(e.type)) {\r\n      onComplete(coordinate, index, coordinates);\r\n      isChange(e);\r\n      document.removeEventListener('contextmenu', onContextMenu, false);\r\n    }\r\n  };\r\n\r\n  const changeStartPosition = (e) => {\r\n    if (['dragstart', 'resizestart'].includes(e.type)) {\r\n      document.addEventListener('contextmenu', onContextMenu, false);\r\n      setPrevCoordinate({ ...coordinate });\r\n      // setPrevCoordinates([...coordinates]);\r\n      setPrevCoordinates(update(index, prevCoordinate, coordinates));\r\n      isChange(e);\r\n    }\r\n  };\r\n\r\n  const handleRestore = () => {\r\n    if (is(Function, onRestore)) {\r\n      onRestore(prevCoordinate, index, prevCoordinates);\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    const nextCoordinates = remove(index, 1)(coordinates);\r\n    if (is(Function, onDelete)) {\r\n      onDelete(coordinate, index, nextCoordinates);\r\n    }\r\n  };\r\n\r\n  const onContextMenu = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (e.button === 2) {\r\n      if (isLeftBtnActive === false) {\r\n        handleDelete();\r\n      }\r\n      if (isLeftBtnActive === true) {\r\n        handleRestore();\r\n        setIsLeftBtnActive(false);\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  const onMouseDown = (e) => {\r\n    if (e.button === 0) {\r\n      // document.addEventListener('mouseup', outsideEvents, false);\r\n      // document.addEventListener('keydown', outsideEvents, false);\r\n      setIsLeftBtnActive(true);\r\n    }\r\n    if (e.button === 2) {\r\n      setIsRightBtnActive(true);\r\n    }\r\n  };\r\n\r\n  const onMouseUp = (e) => {\r\n    if (e.button === 0) {\r\n      // document.removeEventListener('mouseup', outsideEvents, false);\r\n      // document.removeEventListener('keydown', outsideEvents, false);\r\n      document.removeEventListener('contextmenu', onContextMenu, false);\r\n      setIsLeftBtnActive(false);\r\n    }\r\n    if (e.button === 2) {\r\n      setIsRightBtnActive(false);\r\n    }\r\n  };\r\n\r\n  const onKeyDown = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (e.code === 'Escape') {\r\n      handleRestore();\r\n      setIsLeftBtnActive(false);\r\n    }\r\n  };\r\n\r\n  const onKeyUp = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  };\r\n\r\n  const cropStyle = (coordinate): CSSProperties => {\r\n    // const { styles } = this.props\r\n    const { x, y, width, height } = coordinate;\r\n\r\n    return {\r\n      display: 'inline-block',\r\n      position: 'absolute',\r\n      transform: 'translate3d(0, 0, 0)',\r\n      boxSizing: 'border-box',\r\n      cursor: 'move',\r\n      width,\r\n      height,\r\n      top: y,\r\n      left: x,\r\n      border: '1px solid',\r\n      borderImageSource:\r\n        'url(\"data:image/gif;base64,R0lGODlhCgAKAJECAAAAAP///////wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OEI5RDc5MTFDNkE2MTFFM0JCMDZEODI2QTI4MzJBOTIiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OEI5RDc5MTBDNkE2MTFFM0JCMDZEODI2QTI4MzJBOTIiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuZGlkOjAyODAxMTc0MDcyMDY4MTE4MDgzQzNDMjA5MzREQ0ZDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAyODAxMTc0MDcyMDY4MTE4MDgzQzNDMjA5MzREQ0ZDIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEBQoAAgAsAAAAAAoACgAAAhWEERkn7W3ei7KlagMWF/dKgYeyGAUAIfkEBQoAAgAsAAAAAAoACgAAAg+UYwLJ7RnQm7QmsCyVKhUAIfkEBQoAAgAsAAAAAAoACgAAAhCUYgLJHdiinNSAVfOEKoUCACH5BAUKAAIALAAAAAAKAAoAAAIRVISAdusPo3RAzYtjaMIaUQAAIfkEBQoAAgAsAAAAAAoACgAAAg+MDiem7Q8bSLFaG5il6xQAIfkEBQoAAgAsAAAAAAoACgAAAg+UYRLJ7QnQm7SmsCyVKhUAIfkEBQoAAgAsAAAAAAoACgAAAhCUYBLJDdiinNSEVfOEKoECACH5BAUKAAIALAAAAAAKAAoAAAIRFISBdusPo3RBzYsjaMIaUQAAOw==\")',\r\n      borderImageSlice: '1',\r\n      borderImageRepeat: 'repeat',\r\n      msTouchAction: 'none',\r\n      touchAction: 'none',\r\n      userSelect: 'none',\r\n      background: '#262626',\r\n      opacity: 0.5,\r\n      // ...styles,\r\n    };\r\n  };\r\n\r\n  const actionTrigger = (pointer, event, action, interactable, element, interaction) => {\r\n    if (event.type === 'pointermove') {\r\n      //\r\n    }\r\n\r\n    if (event.type === 'pointerdown') {\r\n      //\r\n    }\r\n\r\n    return action;\r\n  };\r\n\r\n  return (\r\n    <div\r\n      onMouseDown={onMouseDown}\r\n      onMouseUp={onMouseUp}\r\n      onContextMenu={onContextMenu}\r\n      style={cropStyle(coordinate)}\r\n      ref={(crop) => {\r\n        cropRef.current = crop;\r\n      }}\r\n      onKeyDown={onKeyDown}\r\n      onKeyUp={onKeyUp}\r\n      tabIndex={0}\r\n    >\r\n      {/* <div> */}\r\n      {hasNumberIcon && <NumberIcon number={index + 1} />}\r\n      {hasDeleteButton && <DeleteIcon onClick={handleDelete} />}\r\n      {cropContent && <CropContent content={coordinate?.content} />}\r\n      {/* </div> */}\r\n      {[styles.ordN, styles.ordNe, styles.ordNw, styles.ordS, styles.ordSe, styles.ordSw, styles.ordE, styles.ordW].map(\r\n        (style, id) => (\r\n          <div className={style} key={id} />\r\n        ),\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// class CropS extends Component<ICropProps, ICropState> {\r\n//   prevCoordinate = {};\r\n\r\n//   prevCoordinates = [];\r\n\r\n//   isLeftBtnActive = false;\r\n\r\n//   isRightBtnActive = false;\r\n\r\n//   crop;\r\n\r\n//   outsideEvents;\r\n\r\n//   componentDidMount() {\r\n//     const { parentImg } = this.props;\r\n//     interact(this.crop)\r\n//       .draggable({\r\n//         modifiers: [\r\n//           interact.modifiers.restrictRect({\r\n//             restriction: 'parent',\r\n//           }),\r\n//           interact.modifiers.restrictSize({\r\n//             min: { width: 1, height: 1 },\r\n//             max: { width: parentImg!.width, height: parentImg!.height },\r\n//           }),\r\n//         ],\r\n//         inertia: true,\r\n//       })\r\n//       .resizable({\r\n//         edges: {\r\n//           left: true,\r\n//           right: true,\r\n//           bottom: true,\r\n//           top: true,\r\n//         },\r\n//         modifiers: [\r\n//           interact.modifiers.restrict({\r\n//             restriction: 'parent',\r\n//           }),\r\n//           interact.modifiers.restrictSize({\r\n//             min: { width: 1, height: 1 },\r\n//             max: { width: parentImg!.width, height: parentImg!.height },\r\n//           }),\r\n//         ],\r\n//         inertia: true,\r\n//       })\r\n//       .on(['dragstart', 'resizestart'], this.changeStartPosition)\r\n//       .on(['dragmove', 'dragend', 'resizemove', 'resizeend'], this.handleChange)\r\n//       .actionChecker(this.actionTrigger);\r\n//   }\r\n\r\n//   shouldComponentUpdate(nextProps) {\r\n//     const { coordinate, index } = this.props;\r\n//     return !equals(nextProps.coordinate, coordinate) || nextProps.index !== index;\r\n//   }\r\n\r\n//   componentWillUnmount() {\r\n//     interact(this.crop).unset();\r\n//   }\r\n\r\n//   handleChange = (e) => {\r\n//     const {\r\n//       index,\r\n//       coordinate,\r\n//       coordinate: { x, y },\r\n//       coordinates,\r\n//       onResize,\r\n//       onDrag,\r\n//       onChange,\r\n//       onComplete,\r\n//       isChange,\r\n//       parentImg,\r\n//     } = this.props;\r\n\r\n//     const { dx, dy } = e;\r\n\r\n//     let nextCoordinate = {};\r\n\r\n//     if (e.type === 'resizemove') {\r\n//       const {\r\n//         rect: { width, height },\r\n//         deltaRect: { left, top, right, bottom },\r\n//       } = e;\r\n//       const resizeCoordinate = {\r\n//         ...(((x + left >= 0 && x + left + width < parentImg!.width) || (x + left >= 0 && left < 0)) && { x: x + left }),\r\n//         ...(((y + top >= 0 && y + top + height < parentImg!.height) || (y + top >= 0 && top < 0)) && { y: y + top }),\r\n//         // x: ((x + left >= 0) && ((x + left + width) < parentImg.width) ) || ((x + left >= 0) && left < 0 ) ? x + left : x,\r\n//         // y: ((y + top >= 0) && ((y + top + height) < parentImg.height) ) || ((y + top >= 0) && top < 0 ) ? y + top : x,\r\n//       };\r\n//       const resize = {\r\n//         width:\r\n//           resizeCoordinate.x + width <= parentImg!.width\r\n//             ? x + left <= 0 && right === 0\r\n//               ? coordinate.width\r\n//               : width\r\n//             : coordinate.width,\r\n//         height:\r\n//           resizeCoordinate.y + height <= parentImg!.height\r\n//             ? y + top <= 0 && bottom === 0\r\n//               ? coordinate.height\r\n//               : height\r\n//             : coordinate.height,\r\n//       };\r\n//       nextCoordinate = {\r\n//         ...coordinate,\r\n//         ...resizeCoordinate,\r\n//         ...resize,\r\n//       };\r\n//     }\r\n//     if (e.type === 'dragmove') {\r\n//       nextCoordinate = { ...coordinate, x: x + dx, y: y + dy };\r\n//     }\r\n//     const nextCoordinates = update(index, nextCoordinate)(coordinates);\r\n\r\n//     if (is(Function, onResize) && e.type === 'resizemove') {\r\n//       onResize(nextCoordinate, index, nextCoordinates);\r\n//     }\r\n//     if (is(Function, onChange) && ['dragmove', 'resizemove'].includes(e.type)) {\r\n//       onChange(nextCoordinate, index, nextCoordinates);\r\n//     }\r\n//     if (is(Function, onDrag) && e.type === 'dragmove') {\r\n//       onDrag(nextCoordinate, index, nextCoordinates);\r\n//     }\r\n//     if (['dragend', 'resizeend'].includes(e.type)) {\r\n//       onComplete(coordinate, index, coordinates);\r\n//       isChange(e);\r\n//       document.removeEventListener('contextmenu', this.onContextMenu, false);\r\n//     }\r\n//   };\r\n\r\n//   changeStartPosition = (e) => {\r\n//     const { index, coordinate, coordinates, isChange } = this.props;\r\n\r\n//     if (['dragstart', 'resizestart'].includes(e.type)) {\r\n//       document.addEventListener('contextmenu', this.onContextMenu, false);\r\n//       this.prevCoordinate = { ...coordinate };\r\n//       this.prevCoordinates = [...coordinates];\r\n//       this.prevCoordinates = update(index, this.prevCoordinate, coordinates);\r\n//       isChange(e);\r\n//     }\r\n//   };\r\n\r\n//   handleRestore = () => {\r\n//     const { index, onRestore } = this.props;\r\n\r\n//     if (is(Function, onRestore)) {\r\n//       onRestore(this.prevCoordinate, index, this.prevCoordinates);\r\n//     }\r\n//   };\r\n\r\n//   handleDelete = () => {\r\n//     const { index, coordinate, onDelete, coordinates } = this.props;\r\n//     const nextCoordinates = remove(index, 1)(coordinates);\r\n//     if (is(Function, onDelete)) {\r\n//       onDelete(coordinate, index, nextCoordinates);\r\n//     }\r\n//   };\r\n\r\n//   onContextMenu = (e) => {\r\n//     e.preventDefault();\r\n//     e.stopPropagation();\r\n//     if (e.button === 2) {\r\n//       if (this.isLeftBtnActive === false) {\r\n//         this.handleDelete();\r\n//       }\r\n//       if (this.isLeftBtnActive === true) {\r\n//         this.handleRestore();\r\n//         this.isLeftBtnActive = false;\r\n//       }\r\n//     }\r\n//     return false;\r\n//   };\r\n\r\n//   onMouseDown = (e) => {\r\n//     if (e.button === 0) {\r\n//       document.addEventListener('mouseup', this.outsideEvents, false);\r\n//       document.addEventListener('keydown', this.outsideEvents, false);\r\n//       this.isLeftBtnActive = true;\r\n//     }\r\n//     if (e.button === 2) {\r\n//       this.isRightBtnActive = true;\r\n//     }\r\n//   };\r\n\r\n//   onMouseUp = (e) => {\r\n//     if (e.button === 0) {\r\n//       document.removeEventListener('mouseup', this.outsideEvents, false);\r\n//       document.removeEventListener('keydown', this.outsideEvents, false);\r\n//       document.removeEventListener('contextmenu', this.onContextMenu, false);\r\n//       this.isLeftBtnActive = false;\r\n//     }\r\n//     if (e.button === 2) {\r\n//       this.isRightBtnActive = false;\r\n//     }\r\n//   };\r\n\r\n//   onKeyDown = (e) => {\r\n//     e.preventDefault();\r\n//     e.stopPropagation();\r\n//     if (e.code === 'Escape') {\r\n//       this.handleRestore();\r\n//       this.isLeftBtnActive = false;\r\n//     }\r\n//   };\r\n\r\n//   onKeyUp = (e) => {\r\n//     e.preventDefault();\r\n//     e.stopPropagation();\r\n//   };\r\n\r\n//   cropStyle = (coordinate): CSSProperties => {\r\n//     // const { styles } = this.props\r\n//     const { x, y, width, height } = coordinate;\r\n\r\n//     return {\r\n//       display: 'inline-block',\r\n//       position: 'absolute',\r\n//       transform: 'translate3d(0, 0, 0)',\r\n//       boxSizing: 'border-box',\r\n//       cursor: 'move',\r\n//       width,\r\n//       height,\r\n//       top: y,\r\n//       left: x,\r\n//       border: '1px solid',\r\n//       borderImageSource:\r\n//         'url(\"data:image/gif;base64,R0lGODlhCgAKAJECAAAAAP///////wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OEI5RDc5MTFDNkE2MTFFM0JCMDZEODI2QTI4MzJBOTIiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OEI5RDc5MTBDNkE2MTFFM0JCMDZEODI2QTI4MzJBOTIiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuZGlkOjAyODAxMTc0MDcyMDY4MTE4MDgzQzNDMjA5MzREQ0ZDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAyODAxMTc0MDcyMDY4MTE4MDgzQzNDMjA5MzREQ0ZDIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEBQoAAgAsAAAAAAoACgAAAhWEERkn7W3ei7KlagMWF/dKgYeyGAUAIfkEBQoAAgAsAAAAAAoACgAAAg+UYwLJ7RnQm7QmsCyVKhUAIfkEBQoAAgAsAAAAAAoACgAAAhCUYgLJHdiinNSAVfOEKoUCACH5BAUKAAIALAAAAAAKAAoAAAIRVISAdusPo3RAzYtjaMIaUQAAIfkEBQoAAgAsAAAAAAoACgAAAg+MDiem7Q8bSLFaG5il6xQAIfkEBQoAAgAsAAAAAAoACgAAAg+UYRLJ7QnQm7SmsCyVKhUAIfkEBQoAAgAsAAAAAAoACgAAAhCUYBLJDdiinNSEVfOEKoECACH5BAUKAAIALAAAAAAKAAoAAAIRFISBdusPo3RBzYsjaMIaUQAAOw==\")',\r\n//       borderImageSlice: '1',\r\n//       borderImageRepeat: 'repeat',\r\n//       msTouchAction: 'none',\r\n//       touchAction: 'none',\r\n//       userSelect: 'none',\r\n//       background: '#262626',\r\n//       opacity: 0.5,\r\n//       // ...styles,\r\n//     };\r\n//   };\r\n\r\n//   actionTrigger = (pointer, event, action, interactable, element, interaction) => {\r\n//     if (event.type === 'pointermove') {\r\n//       //\r\n//     }\r\n\r\n//     if (event.type === 'pointerdown') {\r\n//       //\r\n//     }\r\n\r\n//     return action;\r\n//   };\r\n\r\n//   render() {\r\n//     const { coordinate, index, hasNumberIcon, cropContent, hasDeleteButton } = this.props;\r\n//     return (\r\n//       <div\r\n//         onMouseDown={this.onMouseDown}\r\n//         onMouseUp={this.onMouseUp}\r\n//         onContextMenu={this.onContextMenu}\r\n//         style={this.cropStyle(coordinate)}\r\n//         ref={(crop) => {\r\n//           this.crop = crop;\r\n//         }}\r\n//         onKeyDown={this.onKeyDown}\r\n//         onKeyUp={this.onKeyUp}\r\n//         tabIndex={0}\r\n//       >\r\n//         {/* <div> */}\r\n//         {hasNumberIcon && <NumberIcon number={index + 1} />}\r\n//         {hasDeleteButton && <DeleteIcon onClick={this.handleDelete} />}\r\n//         {cropContent && <CropContent content={coordinate?.content} />}\r\n//         {/* </div> */}\r\n//         {[\r\n//           styles.ordN,\r\n//           styles.ordNe,\r\n//           styles.ordNw,\r\n//           styles.ordS,\r\n//           styles.ordSe,\r\n//           styles.ordSw,\r\n//           styles.ordE,\r\n//           styles.ordW,\r\n//         ].map((style, id) => (\r\n//           <div className={style} key={id} />\r\n//         ))}\r\n//       </div>\r\n//     );\r\n//   }\r\n// }\r\n\r\nexport default Crop;\r\n","import { v4 as uuidv4 } from 'uuid';\r\nimport { assoc, map, omit } from 'ramda'\r\n\r\nexport const addId = map(assoc('id', uuidv4()))\r\n\r\nexport const removeId = map(omit(['id']))\r\n","import React, { CSSProperties, useRef, useState } from 'react';\r\nimport { addIndex, both, clone, complement, equals, is, map } from 'ramda';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport Crop, { TCoordinateType } from './Crop/Crop';\r\n\r\nconst isValidPoint = (point = { x: 0, y: 0 }) => {\r\n  const strictNumber = (number) => both(is(Number), complement(equals(NaN)))(number);\r\n  return strictNumber(point.x) && strictNumber(point.y);\r\n};\r\n\r\nexport interface IMultiCropsProps {\r\n  coordinate?: TCoordinateType;\r\n  coordinates?: TCoordinateType[];\r\n  src?: string;\r\n  cropContent: boolean;\r\n  hasDeleteButton?: boolean;\r\n  hasNumberIcon?: boolean;\r\n  width: number;\r\n  height?: number;\r\n  onDraw?: (...rest) => any | void;\r\n  onChange: (...rest) => any | void;\r\n  onComplete: (...rest) => any | void;\r\n  onRestore: (...rest) => any | void;\r\n  onDelete: (...rest) => any | void;\r\n  onLoad: (...rest) => any | void;\r\n  inProportions?: boolean;\r\n  maxCrops?: number;\r\n  aspectRatio: number;\r\n  styles?: CSSProperties;\r\n}\r\n\r\nconst MultiCrops = (props: IMultiCropsProps): React.ReactElement => {\r\n  const {\r\n    coordinate,\r\n    coordinates = [],\r\n    src = '',\r\n    cropContent = false,\r\n    hasDeleteButton = true,\r\n    hasNumberIcon = true,\r\n    maxCrops = Infinity,\r\n    width,\r\n    height,\r\n    onDraw,\r\n    onChange,\r\n    onComplete,\r\n    onRestore,\r\n    onLoad,\r\n    inProportions,\r\n    aspectRatio,\r\n  } = props;\r\n\r\n  const imgRef = useRef<HTMLImageElement | null>(null);\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  const [drawingIndex, setDrawingIndex] = useState(-1);\r\n  const [pointA, setPointA] = useState<{ x: number; y: number }>({ x: 0, y: 0 });\r\n\r\n  const [id, setId] = useState(uuidv4());\r\n\r\n  const [prevCoordinate, setPrevCoordinate] = useState({});\r\n  const [prevCoordinates, setPrevCoordinates] = useState([]);\r\n\r\n  const [isEscBtnTarget, setIsEscBtnTarget] = useState(false);\r\n  const [isDragResize, setIsDragResize] = useState(false);\r\n  const [isLeftBtnTarget, setIsLeftBtnTarget] = useState(false);\r\n  const [mouseLeave, setMouseLeave] = useState(false);\r\n\r\n  const isChange = (e) => {\r\n    if (['dragstart', 'resizestart'].includes(e.type)) {\r\n      setIsDragResize(true);\r\n    }\r\n    if (['dragend', 'resizeend'].includes(e.type)) {\r\n      setIsDragResize(false);\r\n    }\r\n  };\r\n\r\n  const renderCrops = (props) => {\r\n    const { coordinates } = props;\r\n    const indexedMap = addIndex(map);\r\n    return indexedMap((coor, index) => {\r\n      return (\r\n        <Crop\r\n          // improve performance when delete crop in middle array\r\n          key={coor.id || index}\r\n          index={index}\r\n          coordinate={coor}\r\n          isChange={(e) => {\r\n            isChange(e);\r\n          }}\r\n          parentImg={imgRef.current}\r\n          {...props}\r\n        />\r\n      );\r\n    })(coordinates);\r\n  };\r\n\r\n  const getCursorPosition = (e) => {\r\n    const { left, top } = containerRef.current!.getBoundingClientRect();\r\n    if (e.type === 'touchstart' || e.type === 'touchmove') {\r\n      return {\r\n        x: e.touches[0].pageX - left,\r\n        y: e.touches[0].pageY - top,\r\n      };\r\n    }\r\n    if (e.type === 'mousedown' || e.type === 'mousemove') {\r\n      return {\r\n        x: e.clientX - left,\r\n        y: e.clientY - top,\r\n      };\r\n    }\r\n    return { x: 0, y: 0 };\r\n  };\r\n\r\n  const handleMouseDown = (e) => {\r\n    document.removeEventListener('mouseup', outsideEvents, false);\r\n    document.removeEventListener('keydown', outsideEvents, false);\r\n    document.removeEventListener('contextmenu', onContextMenu, false);\r\n    setIsDragResize(false);\r\n    if (coordinates.length <= maxCrops && (e.button === 0 || e.type === 'touchstart')) {\r\n      setIsLeftBtnTarget(true);\r\n      if (e.target === imgRef.current || e.target === containerRef.current) {\r\n        const { x, y } = getCursorPosition(e);\r\n        setDrawingIndex(coordinates.length);\r\n        setPointA({ x, y });\r\n        setId(uuidv4());\r\n        setIsLeftBtnTarget(true);\r\n        setPrevCoordinate({});\r\n        setPrevCoordinates(clone(coordinates));\r\n        setIsEscBtnTarget(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const outsideEvents = (e): void | boolean => {\r\n    if (e.button === 0) {\r\n      if (isEscBtnTarget === false) {\r\n        if (is(Function, onRestore)) {\r\n          onRestore(coordinate, drawingIndex, coordinates);\r\n        }\r\n        handleMouseUp();\r\n      }\r\n      if (isEscBtnTarget === true && e.target !== imgRef.current) {\r\n        restoreCrops();\r\n        setIsEscBtnTarget(false);\r\n      }\r\n      document.removeEventListener('mouseup', outsideEvents, false);\r\n      document.removeEventListener('keydown', outsideEvents, false);\r\n      document.removeEventListener('contextmenu', onContextMenu, false);\r\n    }\r\n\r\n    if (e.code === 'Escape') {\r\n      setIsEscBtnTarget(true);\r\n    }\r\n\r\n    if (e.button === 2) {\r\n      if (e.target !== imgRef.current) {\r\n        restoreCrops();\r\n      }\r\n    }\r\n    return false;\r\n  };\r\n\r\n  const handleMouseMove = (e) => {\r\n    if (coordinates.length <= maxCrops && (e.button === 0 || e.type === 'touchmove')) {\r\n      if (isValidPoint(pointA) && e.target.offsetParent === imgRef?.current?.offsetParent) {\r\n        const pointB = getCursorPosition(e);\r\n        // get the drawing coordinate\r\n        const coordinate = {\r\n          x: Math.min(pointA.x, pointB.x),\r\n          y: Math.min(pointA.y, pointB.y),\r\n          width: Math.abs(pointA.x - pointB.x),\r\n          height: Math.abs(pointA.y - pointB.y),\r\n          id,\r\n        };\r\n        const nextCoordinates = clone(coordinates);\r\n        nextCoordinates[drawingIndex] = coordinate;\r\n        if (onDraw && is(Function, onDraw)) {\r\n          onDraw(coordinate, drawingIndex, nextCoordinates);\r\n        }\r\n        if (is(Function, onChange)) {\r\n          onChange(coordinate, drawingIndex, nextCoordinates);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const restoreCrops = () => {\r\n    if (is(Function, onRestore)) {\r\n      onRestore(prevCoordinate, drawingIndex - 1, prevCoordinates);\r\n    }\r\n\r\n    setPointA({ x: 0, y: 0 });\r\n    setIsLeftBtnTarget(false);\r\n    setIsEscBtnTarget(false);\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    setPointA({ x: 0, y: 0 });\r\n    setIsLeftBtnTarget(false);\r\n    setMouseLeave(false);\r\n    setIsEscBtnTarget(false);\r\n  };\r\n\r\n  const handleMouseLeave = () => {\r\n    if (isDragResize === false && isLeftBtnTarget === true) {\r\n      document.addEventListener('contextmenu', onContextMenu, false);\r\n      document.addEventListener('mouseup', outsideEvents, false);\r\n      document.addEventListener('keydown', outsideEvents, false);\r\n    }\r\n    setMouseLeave(true);\r\n  };\r\n\r\n  const handleMouseEnter = () => {\r\n    document.removeEventListener('mouseup', outsideEvents, false);\r\n    document.removeEventListener('keydown', outsideEvents, false);\r\n    document.removeEventListener('contextmenu', onContextMenu, false);\r\n    setMouseLeave(false);\r\n  };\r\n\r\n  const onKeyDown = (e) => {\r\n    if (e.code === 'Escape') {\r\n      setIsEscBtnTarget(true);\r\n    }\r\n  };\r\n\r\n  const onContextMenu = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    return false;\r\n  };\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        border: 'none',\r\n        boxSizing: 'content-box',\r\n        position: 'relative',\r\n        msTouchAction: 'none',\r\n        touchAction: 'none',\r\n        userSelect: 'none',\r\n      }}\r\n      onTouchStart={handleMouseDown}\r\n      onTouchMove={handleMouseMove}\r\n      onTouchEnd={() => {\r\n        if (!isEscBtnTarget) {\r\n          handleMouseUp();\r\n          return;\r\n        }\r\n        restoreCrops();\r\n      }}\r\n      onMouseDown={handleMouseDown}\r\n      onMouseMove={handleMouseMove}\r\n      onMouseLeave={handleMouseLeave}\r\n      onMouseEnter={handleMouseEnter}\r\n      onKeyDown={onKeyDown}\r\n      onMouseUp={() => {\r\n        if (!isEscBtnTarget) {\r\n          handleMouseUp();\r\n          return;\r\n        }\r\n        restoreCrops();\r\n      }}\r\n      ref={(container) => {\r\n        containerRef.current = container;\r\n      }}\r\n      tabIndex={0}\r\n    >\r\n      <img\r\n        ref={(img) => {\r\n          imgRef.current = img;\r\n        }}\r\n        width=\"100%\"\r\n        height={width / aspectRatio}\r\n        src={src}\r\n        onLoad={onLoad}\r\n        alt=\"\"\r\n        draggable={false}\r\n        onDragStart={(e) => {\r\n          e.preventDefault();\r\n        }}\r\n      />\r\n      {renderCrops(props)}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport { removeId, addId } from './utils';\r\nexport default MultiCrops;\r\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { is } from 'ramda';\r\nimport _ from 'lodash';\r\n\r\nimport { Canvas, MultiCrops } from './components';\r\nimport styles from './RegionSelector.module.scss';\r\nimport { useDidMountEffect } from './hooks';\r\n\r\nexport interface IRegionSelectorProps {\r\n  src?: string;\r\n  completedCrops?: any[];\r\n  giveCompletedCrops: (...rest) => any;\r\n  isProportions?: boolean;\r\n  isShowCanvas?: boolean;\r\n  cropContent: boolean;\r\n  maxCrops?: number;\r\n  giveCanvas: (...rest) => any;\r\n  width?: number;\r\n  aspectRatio?: number;\r\n  height: number;\r\n}\r\n\r\nconst RegionSelector = (props: IRegionSelectorProps): React.ReactElement => {\r\n  const {\r\n    giveCompletedCrops,\r\n    completedCrops = [],\r\n    src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3PTWBSGcbGzM6GCKqlIBRV0dHRJFarQ0eUT8LH4BnRU0NHR0UEFVdIlFRV7TzRksomPY8uykTk/zewQfKw/9znv4yvJynLv4uLiV2dBoDiBf4qP3/ARuCRABEFAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghgg0Aj8i0JO4OzsrPv69Wv+hi2qPHr0qNvf39+iI97soRIh4f3z58/u7du3SXX7Xt7Z2enevHmzfQe+oSN2apSAPj09TSrb+XKI/f379+08+A0cNRE2ANkupk+ACNPvkSPcAAEibACyXUyfABGm3yNHuAECRNgAZLuYPgEirKlHu7u7XdyytGwHAd8jjNyng4OD7vnz51dbPT8/7z58+NB9+/bt6jU/TI+AGWHEnrx48eJ/EsSmHzx40L18+fLyzxF3ZVMjEyDCiEDjMYZZS5wiPXnyZFbJaxMhQIQRGzHvWR7XCyOCXsOmiDAi1HmPMMQjDpbpEiDCiL358eNHurW/5SnWdIBbXiDCiA38/Pnzrce2YyZ4//59F3ePLNMl4PbpiL2J0L979+7yDtHDhw8vtzzvdGnEXdvUigSIsCLAWavHp/+qM0BcXMd/q25n1vF57TYBp0a3mUzilePj4+7k5KSLb6gt6ydAhPUzXnoPR0dHl79WGTNCfBnn1uvSCJdegQhLI1vvCk+fPu2ePXt2tZOYEV6/fn31dz+shwAR1sP1cqvLntbEN9MxA9xcYjsxS1jWR4AIa2Ibzx0tc44fYX/16lV6NDFLXH+YL32jwiACRBiEbf5KcXoTIsQSpzXx4N28Ja4BQoK7rgXiydbHjx/P25TaQAJEGAguWy0+2Q8PD6/Ki4R8EVl+bzBOnZY95fq9rj9zAkTI2SxdidBHqG9+skdw43borCXO/ZcJdraPWdv22uIEiLA4q7nvvCug8WTqzQveOH26fodo7g6uFe/a17W3+nFBAkRYENRdb1vkkz1CH9cPsVy/jrhr27PqMYvENYNlHAIesRiBYwRy0V+8iXP8+/fvX11Mr7L7ECueb/r48eMqm7FuI2BGWDEG8cm+7G3NEOfmdcTQw4h9/55lhm7DekRYKQPZF2ArbXTAyu4kDYB2YxUzwg0gi/41ztHnfQG26HbGel/crVrm7tNY+/1btkOEAZ2M05r4FB7r9GbAIdxaZYrHdOsgJ/wCEQY0J74TmOKnbxxT9n3FgGGWWsVdowHtjt9Nnvf7yQM2aZU/TIAIAxrw6dOnAWtZZcoEnBpNuTuObWMEiLAx1HY0ZQJEmHJ3HNvGCBBhY6jtaMoEiJB0Z29vL6ls58vxPcO8/zfrdo5qvKO+d3Fx8Wu8zf1dW4p/cPzLly/dtv9Ts/EbcvGAHhHyfBIhZ6NSiIBTo0LNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiEC/wGgKKC4YMA4TAAAAABJRU5ErkJggg==',\r\n    isProportions = false,\r\n    isShowCanvas = true,\r\n    maxCrops = Infinity,\r\n    giveCanvas,\r\n    width = 500,\r\n    aspectRatio = 0.68,\r\n    height = width / aspectRatio,\r\n  } = props;\r\n\r\n  const imgRef = useRef<HTMLImageElement | null>(null);\r\n  const [crops, setCrops] = useState<any[]>([]);\r\n  const [canvas, setCanvas] = useState<any[]>([]);\r\n  const [didMount, setDidMount] = useState<boolean>(false);\r\n\r\n  const completed = (crops) => {\r\n    setCanvas(crops);\r\n    if (is(Function, giveCompletedCrops)) {\r\n      if (isProportions) {\r\n        giveCompletedCrops(() => crops.map((crop) => calcProportions(crop)));\r\n      }\r\n      if (!isProportions) {\r\n        giveCompletedCrops(crops);\r\n      }\r\n    }\r\n  };\r\n\r\n  const calcPosition = (crop) => {\r\n    const { width, height } = (typeof imgRef?.current !== 'undefined' && imgRef?.current) || { width: 0, height: 0 };\r\n\r\n    return {\r\n      ...crop,\r\n      x: parseInt((width * crop.x).toFixed(0), 10),\r\n      y: parseInt((height * crop.y).toFixed(0), 10),\r\n      height: parseInt((height * crop.height).toFixed(0), 10),\r\n      width: parseInt((width * crop.width).toFixed(0), 10),\r\n    };\r\n  };\r\n\r\n  const calcProportions = (crop) => {\r\n    const { width, height } = (typeof imgRef?.current !== 'undefined' && imgRef?.current) || { width: 0, height: 0 };\r\n    return {\r\n      ...crop,\r\n      x: _.floor(crop.x / width, 3),\r\n      y: _.floor(crop.y / height, 3),\r\n      height: _.floor(crop.height / height, 3),\r\n      width: _.floor(crop.width / width, 3),\r\n    };\r\n  };\r\n\r\n  // useEffect(() => {\r\n  //   if (didMount) {\r\n  //     if (isProportions) {\r\n  //       setCrops(() => completedCrops.map((crop) => calcPosition(crop)));\r\n  //     }\r\n  //     if (!isProportions) {\r\n  //       setCrops(completedCrops);\r\n  //     }\r\n  //   }\r\n  //   setDidMount(true);\r\n  //   return () => setDidMount(false);\r\n  // }, [completedCrops, imgRef.current!.width]);\r\n\r\n  useDidMountEffect(() => {\r\n    if (isProportions) {\r\n      setCrops(() => completedCrops.map((crop) => calcPosition(crop)));\r\n    }\r\n    if (!isProportions) {\r\n      setCrops(completedCrops);\r\n    }\r\n  }, [completedCrops, imgRef.current!.width]);\r\n\r\n  const onLoad = useCallback(\r\n    (img) => {\r\n      imgRef.current = img.target;\r\n      // setDidMount(true);\r\n      if (isProportions) {\r\n        setCrops(() => completedCrops.map((crop) => calcPosition(crop)));\r\n        setCanvas(() => completedCrops.map((crop) => calcPosition(crop)));\r\n      }\r\n      if (!isProportions) {\r\n        setCrops(completedCrops);\r\n        setCanvas(completedCrops);\r\n      }\r\n    },\r\n    [completedCrops, isProportions],\r\n  );\r\n\r\n  const onChange = useCallback((crop, index, crops) => {\r\n    setCrops(crops);\r\n    // completed(crops);\r\n  }, []);\r\n\r\n  const onDelete = useCallback((crop, index, crops) => {\r\n    setCrops(crops);\r\n    // completed(crops);\r\n  }, []);\r\n\r\n  const onRestore = useCallback((crop, index, crops) => {\r\n    setCrops(crops);\r\n    // completed(crops);\r\n  }, []);\r\n\r\n  const onComplete = useCallback((crop, index, crops) => {\r\n    setCrops(crops);\r\n    completed(crops);\r\n  }, []);\r\n\r\n  return (\r\n    <div className={styles.regionSelector}>\r\n      <div\r\n        style={{ width: width || imgRef.current?.width }}\r\n        className={styles.multiCrops}\r\n        onTouchEnd={() => {\r\n          completed(crops);\r\n        }}\r\n        onMouseUp={(e) => {\r\n          if (e.button === 0) {\r\n            completed(crops);\r\n          }\r\n        }}\r\n      >\r\n        <MultiCrops\r\n          src={src}\r\n          styles={styles}\r\n          coordinates={crops}\r\n          onChange={onChange}\r\n          onDelete={onDelete}\r\n          onRestore={onRestore}\r\n          onComplete={onComplete}\r\n          onLoad={onLoad}\r\n          width={width}\r\n          aspectRatio={aspectRatio}\r\n          {...props}\r\n        />\r\n      </div>\r\n      {isShowCanvas && (\r\n        <div className={styles.canvasList} style={{ width, height: width / aspectRatio }}>\r\n          {canvas.map((crop, i) => (\r\n            <Canvas key={crop.id || i} crop={crop} img={imgRef.current} />\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RegionSelector;\r\n"],"names":["useCanvas","props","callback","crop","img","canvasRef","useRef","imgRef","current","useEffect","image","canvas","canvasContext","getContext","useDidMountEffect","func","deps","didMount","generateDownload","toBlob","blob","previewUrl","window","URL","createObjectURL","anchor","document","createElement","download","id","href","click","revokeObjectURL","Canvas","useState","isHover","setIsHover","scaleX","naturalWidth","width","scaleY","naturalHeight","height","pixelRatio","devicePixelRatio","setTransform","imageSmoothingQuality","drawImage","x","y","React","position","top","right","color","border","borderRadius","padding","background","opacity","cursor","DeleteIcon","styles","rmcIconContainer","rmcRemove","NumberIcon","number","numberIcon","CropContent","content","cropContent","PropTypes","string","propTypes","oneOfType","defaultProps","Crop","coordinate","coordinates","hasDeleteButton","hasNumberIcon","index","onResize","onDrag","onDelete","onChange","onComplete","onRestore","isChange","parentImg","prevCoordinate","setPrevCoordinate","prevCoordinates","setPrevCoordinates","isLeftBtnActive","setIsLeftBtnActive","isRightBtnActive","setIsRightBtnActive","cropRef","interact","draggable","modifiers","restrictRect","restriction","restrictSize","min","max","inertia","resizable","edges","left","bottom","restrict","on","changeStartPosition","handleChange","actionChecker","actionTrigger","unset","e","dx","dy","nextCoordinate","type","rect","deltaRect","resizeCoordinate","resize","nextCoordinates","update","is","Function","includes","removeEventListener","onContextMenu","addEventListener","handleRestore","handleDelete","remove","preventDefault","stopPropagation","button","onMouseDown","onMouseUp","onKeyDown","code","onKeyUp","cropStyle","display","transform","boxSizing","borderImageSource","borderImageSlice","borderImageRepeat","msTouchAction","touchAction","userSelect","pointer","event","action","interactable","element","interaction","ordN","ordNe","ordNw","ordS","ordSe","ordSw","ordE","ordW","map","style","addId","assoc","uuidv4","removeId","omit","isValidPoint","point","strictNumber","both","Number","complement","equals","NaN","MultiCrops","src","maxCrops","Infinity","onDraw","onLoad","inProportions","aspectRatio","containerRef","drawingIndex","setDrawingIndex","pointA","setPointA","setId","isEscBtnTarget","setIsEscBtnTarget","isDragResize","setIsDragResize","isLeftBtnTarget","setIsLeftBtnTarget","mouseLeave","setMouseLeave","renderCrops","indexedMap","addIndex","coor","getCursorPosition","getBoundingClientRect","touches","pageX","pageY","clientX","clientY","handleMouseDown","outsideEvents","length","target","clone","handleMouseUp","restoreCrops","handleMouseMove","offsetParent","pointB","Math","abs","handleMouseLeave","handleMouseEnter","container","RegionSelector","giveCompletedCrops","completedCrops","isProportions","isShowCanvas","crops","setCrops","setCanvas","completed","calcProportions","calcPosition","parseInt","toFixed","_","floor","useCallback","regionSelector","multiCrops","canvasList","i"],"mappings":"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"}